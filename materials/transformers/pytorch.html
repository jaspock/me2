<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Aprender a programar con PyTorch | Juan Antonio Pérez-Ortiz</title> <meta name="author" content="Juan Antonio Pérez-Ortiz"> <meta name="description" content="Estudio de la librería con la que programar los modelos neuronales"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700%7CRoboto+Slab:100,300,400,500,700%7CMaterial+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%92%AC&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/me2/assets/css/main.css"> <link rel="canonical" href="https://jaspock.github.io/me2/materials/transformers/pytorch"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/me2/assets/js/theme.js"></script> <script src="/me2/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/me2/"><span class="font-weight-bold">Juan Antonio </span>Pérez-Ortiz</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/me2/">about</a> </li> <li class="nav-item "> <a class="nav-link" href="/me2/blog/">blog</a> </li> <li class="nav-item "> <a class="nav-link" href="/me2/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/me2/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/me2/materials/">materials</a> </li> <li class="nav-item "> <a class="nav-link" href="/me2/cv/">cv</a> </li> <li class="nav-item "> <a class="nav-link" href="/me2/teaching/">teaching</a> </li> <li class="nav-item "> <a class="nav-link" href="/me2/repositories/">repositories</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Aprender a programar con PyTorch</h1> <p class="post-description">Estudio de la librería con la que programar los modelos neuronales</p> </header> <article> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/me2/assets/img/transformers/book-robot-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/me2/assets/img/transformers/book-robot-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/me2/assets/img/transformers/book-robot-1400.webp"></source> <img src="/me2/assets/img/transformers/book-robot.png" class="img-fluid rounded z-depth-1" width="256px" height="256px" title="ai-generated image" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p class="small-text">Nota: este capítulo es parte de la serie “<a href="../transformers">Un recorrido peso a peso por el transformer</a>”, donde se presenta una guía para aprender cómo funcionan las redes neuronales que procesan textos y cómo se programan.</p> <p>La librería <a href="https://pytorch.org/" rel="external nofollow noopener" target="_blank">PyTorch</a> es junto a <a href="https://www.tensorflow.org/" rel="external nofollow noopener" target="_blank">TensorFlow</a> y <a href="https://github.com/google/jax" rel="external nofollow noopener" target="_blank">JAX</a> una de las librerías más populares para programar modelos neuronales a bajo nivel. Dado que nuestro objetivo es comprender y modificar el código del transformer, es necesario que aprendas a usar PyTorch.</p> <h2 id="python">Python</h2> <p><i class="fas fa-clock"></i> 2 horas</p> <p>Python es a día de hoy el lenguaje de programación más usado en el mundo del procesamiento del lenguaje natural. Para usar PyTorch necesitarás conocer los elementos fundamentales del lenguaje Python. Se trata de un lenguaje dinámico, pero probablemente no se parecerá mucho a otros lenguajes de este tipo que conozcas. Pese a ello, no tiene sentido que aprendas Python desde cero, ya que muchos elementos básicos del lenguaje (bucles, funciones, clases, etc.) no se alejan mucho de los que ya conoces para otros lenguajes.</p> <p>Los cursos de aprendizaje automático suelen incluir una introducción a Python para programadores experimentados en otros lenguajes. En este área es también muy frecuente usar librerías para cálculo científico como NumPy. Aunque nosotros usaremos librerías más específicas como PyTorch, esta comparte muchos principios de diseño con NumPy, por lo que es recomendable que aprendas algo de NumPy también.</p> <p>Sigue estos tutoriales. Usa más de una fuente para así aprender más:</p> <ul> <li>El tutorial “<a href="https://cs231n.github.io/python-numpy-tutorial/" rel="external nofollow noopener" target="_blank">Python Numpy Tutorial (with Jupyter and Colab)</a>” <a href="https://cs231n.github.io/python-numpy-tutorial/" rel="external nofollow noopener" target="_blank"><i class="fas fa-file"></i></a> del curso “CS231n: Deep Learning for Computer Vision” de Stanford University. Observa que en la parte superior aparece una insignia que dice “Open in Colab”. Clicando en ella puedes abrir un entorno de ejecución basado en Python en la nube desde la que ejecutar el código de ejemplo como un cuaderno de Python.</li> <li>Las diapositivas “<a href="https://web.stanford.edu/class/cs224n/readings/cs224n-python-review.pdf" rel="external nofollow noopener" target="_blank">Python Review Session</a>” <a href="https://web.stanford.edu/class/cs224n/readings/cs224n-python-review.pdf" rel="external nofollow noopener" target="_blank"><i class="fas fa-file"></i></a> del curso “CS224n: Natural Language Processing with Deep Learning” de Stanford University. También tienes un <a href="https://web.stanford.edu/class/cs224n/readings/python_tutorial.ipynb" rel="external nofollow noopener" target="_blank">cuaderno de Python</a> <a href="https://web.stanford.edu/class/cs224n/readings/python_tutorial.ipynb" rel="external nofollow noopener" target="_blank"><i class="fas fa-file"></i></a> que puedes descargar y subir a Google Colab.</li> </ul> <p>Cuando necesites profundizar o entender ciertas estructuras de Python, puedes consultar la <a href="https://docs.python.org/3.10/tutorial/index.html" rel="external nofollow noopener" target="_blank">documentación oficial</a> de Python.</p> <h2 id="cuadernos">Cuadernos</h2> <p><i class="fas fa-clock"></i> 1 hora</p> <p>El uso de los cuadernos de Jupyter y de Google Colab se explica en los apartados 20.1 (“<a href="https://d2l.ai/chapter_appendix-tools-for-deep-learning/jupyter.html" rel="external nofollow noopener" target="_blank">Using Jupyter Notebooks</a>” <a href="https://d2l.ai/chapter_appendix-tools-for-deep-learning/jupyter.html" rel="external nofollow noopener" target="_blank"><i class="fas fa-file"></i>)</a> y 20.4 (“<a href="https://d2l.ai/chapter_appendix-tools-for-deep-learning/colab.html" rel="external nofollow noopener" target="_blank">Using Google Colab</a>” <a href="https://d2l.ai/chapter_appendix-tools-for-deep-learning/colab.html" rel="external nofollow noopener" target="_blank"><i class="fas fa-file"></i></a>) del libro de “Dive into Deep Learning”.</p> <h2 id="pytorch">PyTorch</h2> <p><i class="fas fa-clock"></i> 2 horas</p> <p>PyTorch no es en principio una librería sencilla de entender. Al estudiar de primeras el código de un modelo neuronal programado en PyTorch, es posible que no entiendas ciertas partes o que no seas capaz de deducir todo el comportamiento implícito subyacente. Es por ello que un esfuerzo inicial de estudio de la librería es necesario.</p> <p>Puedes hacerte una idea somera de los fundamentos de PyTorch siguiendo la breve <a href="https://d2l.ai/chapter_preliminaries/ndarray.html" rel="external nofollow noopener" target="_blank">introducción a PyTorch</a> <a href="https://d2l.ai/chapter_preliminaries/ndarray.html" rel="external nofollow noopener" target="_blank"><i class="fas fa-file"></i></a> que se incluye como parte del libro “Dive into Deep Learning”; observa que puedes ver los ejemplos de PyTorch en la página web, pero también abrir un cuaderno en Colab o en SageMaker Studio Lab. Sin embargo, como se ha mencionado, necesitarás ahondar más en los entresijos de la librería: sigue para ello el tutorial en vídeo de más de 2 horas de esta <a href="https://www.youtube.com/playlist?list=PL_lsbAsL_o2CTlGHgMxNrKhzP97BaG9ZN" rel="external nofollow noopener" target="_blank">playlist oficial de PyTorch</a>. <a href="https://www.youtube.com/playlist?list=PL_lsbAsL_o2CTlGHgMxNrKhzP97BaG9ZN" rel="external nofollow noopener" target="_blank"><i class="fas fa-file"></i></a> Mírate al menos los 4 primeros vídeos (“Introduction to PyTorch”, “Introduction to PyTorch Tensors”, “The Fundamentals of Autograd” y “Building Models with PyTorch”).</p> <p>Como complemento a lo anterior, puedes consultar también el <a href="https://pytorch.org/tutorials/beginner/basics/intro.html" rel="external nofollow noopener" target="_blank">tutorial oficial</a> de PyTorch. Asegúrate de seleccionar tu versión de PyTorch en la esquina superior izquierda. Es especialmente didáctico este corto <a href="https://pytorch.org/tutorials/beginner/pytorch_with_examples.html" rel="external nofollow noopener" target="_blank">tutorial con ejemplos sencillos</a> de ajuste de la función $a +bx + cx^2 + dx^3$. Finalmente, cuando necesites profundizar en algún elemento particular de PyTorch, puedes recurrir a la <a href="https://pytorch.org/docs/stable/index.html" rel="external nofollow noopener" target="_blank">documentación oficial de PyTorch</a>.</p> <h2 id="depuración">Depuración</h2> <p>Depurar es una de las mejores maneras de comprender todos los secretos del código que estás estudiando. Es importante que te sientas cómodo con el proceso de depuración. A continuación, se dan algunos consejos para depurar código en Python usando el entorno de VS Code, pero instrucciones similares son válidas para otros entornos de desarrollo.</p> <p>Para depurar el fichero actual, coloca uno o más puntos de interrupción en el código clicando en la pequeña columna que hay a la izquierda de los números de línea hasta que aparezca una marca roja. Luego, asegúrate de que tienes el entorno de ejecución de Python adecuado seleccionado en la barra inferior y ejecuta <code class="language-plaintext highlighter-rouge">Run/Start Debugging</code> (<code class="language-plaintext highlighter-rouge">F5</code>) en el menú. El código se ejecutará hasta que se alcance el punto de interrupción. Puedes hacer que el código se ejecute paso a paso usando <code class="language-plaintext highlighter-rouge">Run/Step Over</code> o <code class="language-plaintext highlighter-rouge">Run/Step Into</code>, pero ganarás mucho tiempo si te aprendes los atajos de teclado correspondientes (<code class="language-plaintext highlighter-rouge">F10</code>y <code class="language-plaintext highlighter-rouge">F11</code>, respectivamente). Además de inspeccionar las variables desde la interfaz, te será muy útil acceder a la paleta de órdenes (<code class="language-plaintext highlighter-rouge">Help/Show All Commands</code>o bien <code class="language-plaintext highlighter-rouge">Ctrl+Shift+P</code>) y mostrar el terminal de depuración tecleando <code class="language-plaintext highlighter-rouge">Debug Console</code>. En este terminal puedes ejecutar cualquier código en Python para, por ejemplo:</p> <ul> <li>ver el tipo de una variable: <code class="language-plaintext highlighter-rouge">type(learning_rate)</code> </li> <li>ver el contenido de un tensor: <code class="language-plaintext highlighter-rouge">x</code> </li> <li>ver la forma de un tensor: <code class="language-plaintext highlighter-rouge">x.shape</code> </li> <li>ver la salida de una función ya definida escribiendo líneas como <code class="language-plaintext highlighter-rouge">sigmoid(torch.tensor([-10.2,0.1,10.2]))</code> o <code class="language-plaintext highlighter-rouge">torch.logical_not(mask[:10])</code> </li> </ul> <p>Si el tensor es grande, suele ser suficiente para nuestros propósitos ver solo unos cuantos de sus elementos, lo que puedes hacer mediante indexación como en <code class="language-plaintext highlighter-rouge">x[:10]</code>. Para que sistemáticamente PyTorch muestre solo los primeros elementos de cada dimensión y use una cantidad limitada de decimales puedes hacer una sola vez:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">torch</span><span class="p">.</span><span class="nf">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">edgeitems</span><span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</code></pre></div></div> <h2 id="más-detalles-sobre-pytorch">Más detalles sobre PyTorch</h2> <p>La página de <a href="apuntes">apuntes</a> sobre PyTorch recoge algunos detalles adicionales sobre la librería necesarios para entender las implementaciones de modelos que vamos a estudiar.</p> <h2 id="implementaciones-adicionales">Implementaciones adicionales</h2> <p>El proyecto <a href="https://github.com/dpressel/mint" rel="external nofollow noopener" target="_blank">MinT</a> incluye diferentes tutoriales con implementaciones desde cero de modelos tipo BERT, GPT, BART o T5. El código es ligeramente más extenso que el que hemos estudiado, pero puede servir para afianzar conocimientos en una fase avanzada. El proyecto <a href="https://github.com/lucidrains/x-transformers" rel="external nofollow noopener" target="_blank">x-transformers</a> sigue un enfoque similar.</p> <p>Existe cierto pique entre los desarrolladores por conseguir una implementación del transformer lo más compacta posible. Algunas de ellas son <a href="https://github.com/karpathy/minGPT" rel="external nofollow noopener" target="_blank">minGPT</a>, <a href="https://github.com/karpathy/nanoGPT" rel="external nofollow noopener" target="_blank">nanoGPT</a> y <a href="https://github.com/jaymody/picoGPT" rel="external nofollow noopener" target="_blank">picoGPT</a>. Un aspecto destacable de estas es que son capaces de cargar los pesos de GPT-2 y realizar inferencia con ellos. Andrej Karpathy, el desarrollador de minGPT y nanoGPT tiene un <a href="https://youtu.be/kCc8FmEb1nY%C3%A7" rel="external nofollow noopener" target="_blank">vídeo</a> muy pedagógico en el que explica el funcionamiento de su implementación.</p> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 Juan Antonio Pérez-Ortiz. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/me2/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/me2/assets/js/zoom.js"></script> <script defer src="/me2/assets/js/common.js"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>